function sizeLayerControl(){$(".leaflet-control-layers").css("max-height",$("#map").height()-50)}function clearHighlight(){highlight.clearLayers()}function sidebarClick(e){var t=markerClusters.getLayer(e);map.setView([t.getLatLng().lat,t.getLatLng().lng],17),t.fire("click"),document.body.clientWidth<=767&&($("#sidebar").hide(),map.invalidateSize())}function syncSidebar(){$("#feature-list tbody").empty(),maraes.eachLayer(function(e){map.hasLayer(maraeLayer)&&map.getBounds().contains(e.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(e)+'" lat="'+e.getLatLng().lat+'" lng="'+e.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/marae.png"></td><td class="feature-name">'+e.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),campsites.eachLayer(function(e){map.hasLayer(campsiteLayer)&&map.getBounds().contains(e.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(e)+'" lat="'+e.getLatLng().lat+'" lng="'+e.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/camping.png"></td><td class="feature-name">'+e.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),carparks.eachLayer(function(e){map.hasLayer(carparkLayer)&&map.getBounds().contains(e.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(e)+'" lat="'+e.getLatLng().lat+'" lng="'+e.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/carpark.png"></td><td class="feature-name">'+e.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),huts.eachLayer(function(e){map.hasLayer(hutLayer)&&map.getBounds().contains(e.getLatLng())&&$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(e)+'" lat="'+e.getLatLng().lat+'" lng="'+e.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/hut.png"></td><td class="feature-name">'+e.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>')}),featureList=new List("features",{valueNames:["feature-name"]}),featureList.sort("feature-name",{order:"asc"})}function updateAttribution(e){$.each(map._layers,function(e,t){t.getAttribution&&$("#attribution").html(t.getAttribution())})}var map,featureList,huntingareaSearch=[],maraeSearch=[],campsiteSearch=[],carparkSearch=[],hutSearch=[];$(window).resize(function(){sizeLayerControl()}),$(document).on("click",".feature-row",function(e){$(document).off("mouseout",".feature-row",clearHighlight),sidebarClick(parseInt($(this).attr("id"),10))}),$(document).on("mouseover",".feature-row",function(e){highlight.clearLayers().addLayer(L.circleMarker([$(this).attr("lat"),$(this).attr("lng")],highlightStyle))}),$(document).on("mouseout",".feature-row",clearHighlight),$("#about-btn").click(function(){return $("#aboutModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#full-extent-btn").click(function(){return map.fitBounds(bounds),$(".navbar-collapse.in").collapse("hide"),!1}),$("#legend-btn").click(function(){return $("#legendModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#login-btn").click(function(){return $("#loginModal").modal("show"),$(".navbar-collapse.in").collapse("hide"),!1}),$("#list-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#nav-btn").click(function(){return $(".navbar-collapse").collapse("toggle"),!1}),$("#sidebar-toggle-btn").click(function(){return $("#sidebar").toggle(),map.invalidateSize(),!1}),$("#sidebar-hide-btn").click(function(){$("#sidebar").hide(),map.invalidateSize()}),L.mapbox.accessToken="pk.eyJ1IjoidGUtdXJ1LXRhdW1hdHVhIiwiYSI6Ik9EQ1ZRRHcifQ.GEzpoVoQluLYpyjnjq2RtQ";var mapboxStreets=L.tileLayer("https://a.tiles.mapbox.com/v4/maptec.l62kg4fn/{z}/{x}/{y}.png?access_token="+L.mapbox.accessToken,{maxZoom:14,minZoom:5,attribution:'<a href="http://www.mapbox.com/about/maps/" target="_blank"></a>'}),mapboxSatellite=L.tileLayer("https://a.tiles.mapbox.com/v4/maptec.l622jkj0/{z}/{x}/{y}.png?access_token="+L.mapbox.accessToken,{maxZoom:11,minZoom:5,attribution:'<a href="http://www.mapbox.com/about/maps/" target="_blank"></a>'}),topo50=L.tileLayer("http://tiles-a.data-cdn.linz.govt.nz/services;key=6cd48aeb0e094593b002f67ef2d58ff7/tiles/v4/layer=2343/EPSG:3857/{z}/{x}/{y}.png",{maxZoom:19,minZoom:12.1,subdomains:"abcd",attribution:'<a href="http://data.linz.govt.nz">Sourced from LINZ. CC-BY 3.0</a>'}),topo250=L.tileLayer("http://tiles-a.data-cdn.linz.govt.nz/services;key=6cd48aeb0e094593b002f67ef2d58ff7/tiles/v4/layer=2324/EPSG:3857/{z}/{x}/{y}.png",{maxZoom:12,minZoom:9,subdomains:"abcd",attribution:'<a href="http://data.linz.govt.nz">Sourced from LINZ. CC-BY 3.0</a>'}),aerialphoto=L.tileLayer("http://tiles-a.data-cdn.linz.govt.nz/services;key=6cd48aeb0e094593b002f67ef2d58ff7/tiles/v4/set=2/EPSG:3857/{z}/{x}/{y}.png",{maxZoom:19,minZoom:13,subdomains:"abcd",attribution:'<a href="http://www.linz.govt.nz/data/licensing-and-using-data/attributing-aerial-imagery-data">Sourced from LINZ. CC-BY 3.0</a>'}),highlight=L.geoJson(null),highlightStyle={stroke:!1,fillColor:"#00ffff",fillOpacity:.7,radius:10},possumblocks=L.geoJson(null,{style:function(e){return"No"===e.properties.Vacant?{color:"#505050",fillColor:"#ff00cc",fill:!0,fillOpacity:.4,opacity:.8,weight:2}:"Yes"===e.properties.Vacant?{color:"#505050",fillColor:"#cc6600",fill:!0,fillOpacity:.2,opacity:.8,weight:2}:void 0},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-responsive table-striped table-bordered table-condensed'><thead><tr><th>Block Number</th><th>Locality</th><th>Vacant</th></tr></thead><tr><td>"+e.properties.Block_id+"</td><td>"+e.properties.Locality+"</td><td>"+e.properties.Vacant+"</td><td><table>";t.on({click:function(e){$("#feature-title").html("Possum Permit Block"),$("#feature-info").html(a),$("#featureModal").modal("show")}})}t.on({mouseover:function(e){var t=e.target;t.setStyle({weight:3,color:"#fff000",dashArray:"",opacity:1}),t.bringToFront()},mouseout:function(e){possumblocks.resetStyle(e.target)}})}});$.getJSON("data/possumblk.geojson",function(e){possumblocks.addData(e)});var pesticidebuffers=L.geoJson(null,{style:function(e){return 1e3===e.properties.distance?{color:"#6B082B",fillColor:"#6B082B",fill:!0,fillOpacity:.3,opacity:.5,weight:1,dashArray:"3"}:2e3===e.properties.distance?{color:"#AE0E46",fillColor:"#AE0E46",fill:!0,fillOpacity:.5,opacity:.5,weight:1,dashArray:"3"}:5e3===e.properties.distance?{color:"#F11360",fillColor:"#F11360",fill:!0,fillOpacity:.5,opacity:.5,weight:1,dashArray:"3"}:void 0},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-responsive table-striped table-bordered table-condensed'><thead><tr><th>Buffer distance(m)</th><th>Do not take or eat</th></tr></thead><tr><td>"+e.properties.distance+"</td><td>"+e.properties.DNT+"</td><td><table>";t.on({click:function(e){$("#feature-title").html("Pesticide Buffer Area"),$("#feature-info").html(a),$("#featureModal").modal("show")}})}t.on({mouseover:function(e){var t=e.target;t.setStyle({weight:3,color:"#fff000",dashArray:"",opacity:1}),t.bringToFront()},mouseout:function(e){pesticidebuffers.resetStyle(e.target)}})}});$.getJSON("data/pestbuff.geojson",function(e){pesticidebuffers.addData(e)});var pesticideareas=L.geoJson(null,{style:function(e){return"Te Urewera Mainland Island"===e.properties.Op_Name?{color:"#9a9a00",fillColor:"yellow",fill:!0,fillOpacity:.5,opacity:.7,weight:2,dashArray:"4"}:"Waikareiti Islands"===e.properties.Op_Name?{color:"#9a9a00",fillColor:"#990000",fill:!0,fillOpacity:.5,opacity:.7,weight:2,dashArray:"4"}:"Whirinaki Te Pua-a-Tane Conservation Park"===e.properties.Op_Name?{color:"#9e1214",fillColor:"#cc6600",fill:!0,fillOpacity:.4,opacity:.7,weight:2,dashArray:"4"}:void 0},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-responsive table-striped table-bordered table-condensed'><thead><tr><th>Pesticide</th><th>Bait</th><th>Method</th><th>Approx. Expiry Date</th></tr></thead><tr><td>"+e.properties.Pest1+"</td><td>"+e.properties.Bait1+"</td><td>"+e.properties.Meth1+"</td><td>"+e.properties.EndDate1+"</td></tr><tr><td>"+e.properties.Pest2+"</td><td>"+e.properties.Bait2+"</td><td>"+e.properties.Meth2+"</td><td>"+e.properties.EndDate2+"</td></tr><tr><td>"+e.properties.Pest3+"</td><td>"+e.properties.Bait3+"</td><td>"+e.properties.Meth3+"</td><td>"+e.properties.EndDate3+"</td></tr><table>";t.on({click:function(t){$("#feature-title").html(e.properties.Op_Cat+" at "+e.properties.Op_Name+"<br>taking of animals is not recommended in pesticide areas"),$("#feature-info").html(a),$("#featureModal").modal("show")}})}t.on({mouseover:function(e){var t=e.target;t.setStyle({weight:3,color:"#fff000",dashArray:"",opacity:1}),t.bringToFront()},mouseout:function(e){pesticideareas.resetStyle(e.target)}})}});$.getJSON("data/pestsumm.geojson",function(e){pesticideareas.addData(e)});var huntingareas=L.geoJson(null,{style:function(e){return"Open"===e.properties.block?{color:"#000000",fillColor:"#666633",fill:!0,fillOpacity:.1,opacity:.5,weight:2}:"Closed"===e.properties.block?{color:"#000000",fillColor:"#ff0033",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Closed, Waikaremoana Great Walk"===e.properties.block?{color:"#000000",fillColor:"#333333",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Closed, Puketukutuku Kiwi Recovery Area"===e.properties.block?{color:"#000000",fillColor:"#990099",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Closed, Whareama Kiwi Recovery Area"===e.properties.block?{color:"#000000",fillColor:"#990099",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Closed, Northern Te Urewera Biodiversity Recovery Area"===e.properties.block?{color:"#000000",fillColor:"#990099",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Closed, Waikareiti Biodiversity Recovery Area"===e.properties.block?{color:"#000000",fillColor:"#990099",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Open, no dogs at any time"===e.properties.block?{color:"#000000",fillColor:"#ffff11",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Open, Ruakituri Wilderness area, no helicopter access, no dogs at any time"===e.properties.block?{color:"#000000",fillColor:"#cccc33",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Open, 1 February to 21 December"===e.properties.block?{color:"#000000",fillColor:"#ffff99",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"Private Tuhoe land"===e.properties.block?{color:"#000000",fillColor:"#990000",fill:!0,fillOpacity:.5,opacity:.5,weight:2}:"border"===e.properties.block?{color:"#000000",fill:!1,opacity:1,weight:5}:void 0},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Te Urewera current hunting availability</th><td>"+e.properties.block+"</td></tr><table>";t.on({click:function(e){$("#feature-title").html("Status"),$("#feature-info").html(a),$("#featureModal").modal("show")}})}t.on({mouseover:function(e){var t=e.target;t.setStyle({weight:4,color:"#ffffff",opacity:1}),t.bringToBack()},mouseout:function(e){huntingareas.resetStyle(e.target)}})}});$.getJSON("data/hunting.geojson",function(e){huntingareas.addData(e)});var markerClusters=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,disableClusteringAtZoom:16}),maraeLayer=L.geoJson(null),maraes=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/marae.png",iconSize:[24,28],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+e.properties.NAME+"</td></tr><tr><th>Website</th><td><a class='url-break' href='"+e.properties.URL+"' target='_blank'>"+e.properties.URL+"</a></td></tr><table>";t.on({click:function(t){$("#feature-title").html("Marae"),$("#feature-info").html(a),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(t)+'" lat="'+t.getLatLng().lat+'" lng="'+t.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/marae.png"></td><td class="feature-name">'+t.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),maraeSearch.push({name:t.feature.properties.NAME,source:"Maraes",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});$.getJSON("data/maraes.geojson",function(e){maraes.addData(e)});var campsiteLayer=L.geoJson(null),campsites=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/camping.png",iconSize:[32,37],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+e.properties.NAME+"</td></tr><tr><th>Booking</th><td>"+e.properties.booking+"</td></tr><table>";t.on({click:function(t){$("#feature-title").html("Campsite"),$("#feature-info").html(a),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(t)+'" lat="'+t.getLatLng().lat+'" lng="'+t.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/camping.png"></td><td class="feature-name">'+t.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),campsiteSearch.push({name:t.feature.properties.NAME,source:"Campsites",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});$.getJSON("data/campsites.geojson",function(e){campsites.addData(e)});var carparkLayer=L.geoJson(null),carparks=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/carpark.png",iconSize:[32,37],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+e.properties.NAME+"</td></tr><table>";t.on({click:function(t){$("#feature-title").html("Carpark"),$("#feature-info").html(a),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(t)+'" lat="'+t.getLatLng().lat+'" lng="'+t.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/carpark.png"></td><td class="feature-name">'+t.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),carparkSearch.push({name:t.feature.properties.NAME,source:"Carparks",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});$.getJSON("data/carparks.geojson",function(e){carparks.addData(e)});var hutLayer=L.geoJson(null),huts=L.geoJson(null,{pointToLayer:function(e,t){return L.marker(t,{icon:L.icon({iconUrl:"assets/img/hut.png",iconSize:[32,37],iconAnchor:[12,28],popupAnchor:[0,-25]}),title:e.properties.NAME,riseOnHover:!0})},onEachFeature:function(e,t){if(e.properties){var a="<table class='table table-striped table-bordered table-condensed'><tr><th>Name</th><td>"+e.properties.NAME+"</td></tr><tr><th>Capacity</th><td>"+e.properties.sleep+"</td></tr><tr><th>Heating</th><td>"+e.properties.heat+"</td></tr><tr><th>Booking</th><td>"+e.properties.booking+"</td></tr><table>";t.on({click:function(t){$("#feature-title").html(e.properties.category),$("#feature-info").html(a),$("#featureModal").modal("show"),highlight.clearLayers().addLayer(L.circleMarker([e.geometry.coordinates[1],e.geometry.coordinates[0]],highlightStyle))}}),$("#feature-list tbody").append('<tr class="feature-row" id="'+L.stamp(t)+'" lat="'+t.getLatLng().lat+'" lng="'+t.getLatLng().lng+'"><td style="vertical-align: middle;"><img width="16" height="18" src="assets/img/hut.png"></td><td class="feature-name">'+t.feature.properties.NAME+'</td><td style="vertical-align: middle;"><i class="fa fa-chevron-right pull-right"></i></td></tr>'),hutSearch.push({name:t.feature.properties.NAME,source:"Huts",id:L.stamp(t),lat:t.feature.geometry.coordinates[1],lng:t.feature.geometry.coordinates[0]})}}});$.getJSON("data/huts.geojson",function(e){huts.addData(e)});var southWest=L.latLng(-38.99,176.65),northEast=L.latLng(-38.05,177.82),bounds=L.latLngBounds(southWest,northEast);map=L.map("map",{zoom:10,center:[-38.4901,176.9046],layers:[mapboxStreets,huntingareas,markerClusters,highlight],zoomControl:!1,attributionControl:!1,maxBounds:bounds}),L.control.zoomslider().addTo(map),map.on("overlayadd",function(e){e.layer===maraeLayer&&(markerClusters.addLayer(maraes),syncSidebar()),e.layer===campsiteLayer&&(markerClusters.addLayer(campsites),syncSidebar()),e.layer===carparkLayer&&(markerClusters.addLayer(carparks),syncSidebar()),e.layer===hutLayer&&(markerClusters.addLayer(huts),syncSidebar())}),map.on("overlayremove",function(e){e.layer===maraeLayer&&(markerClusters.removeLayer(maraes),syncSidebar()),e.layer===campsiteLayer&&(markerClusters.removeLayer(campsites),syncSidebar()),e.layer===carparkLayer&&(markerClusters.removeLayer(carparks),syncSidebar()),e.layer===hutLayer&&(markerClusters.removeLayer(huts),syncSidebar())}),map.on("moveend",function(e){syncSidebar()}),map.on("click",function(e){highlight.clearLayers()}),map.on("layeradd",updateAttribution),map.on("layerremove",updateAttribution);var attributionControl=L.control({position:"bottomright"});attributionControl.onAdd=function(e){var t=L.DomUtil.create("div","leaflet-control-attribution");return t.innerHTML="<span class='hidden-xs'>Developed for Te Uru Taumatua by <a href='http://www.maptec.org'>Maptec</a> | </span><a href='#' onclick='$(\"#attributionModal\").modal(\"show\"); return false;'>Attribution</a>",t},map.addControl(attributionControl);var scaleControl=L.control.scale({metric:!0}).addTo(map),locateControl=L.control.locate({position:"topleft"}).addTo(map);if(document.body.clientWidth<=767)var isCollapsed=!0;else var isCollapsed=!1;var topographic=L.layerGroup([topo50,topo250]),imagery=L.layerGroup([mapboxSatellite,aerialphoto]),baseLayers={Terrain:mapboxStreets,"NZ Topo maps":topographic,Imagery:imagery},groupedOverlays={"Points of Interest":{"<img src='assets/img/marae16.png' width='16' height='18'>&nbsp;Marae":maraeLayer,"<img src='assets/img/camping16.png' width='16' height='18'>&nbsp;Campsites":campsiteLayer,"<img src='assets/img/carpark16.png' width='16' height='18'>&nbsp;Carparks":carparkLayer,"<img src='assets/img/hut16.png' width='16' height='18'>&nbsp;Huts":hutLayer},"Hunting layers":{"Public Hunting status":huntingareas},"Pesticide layers":{"Pesticide areas":pesticideareas,"Pesticide buffer zones":pesticidebuffers}},layerControl=L.control.groupedLayers(baseLayers,groupedOverlays,{collapsed:isCollapsed}).addTo(map);$("#searchbox").click(function(){$(this).select()}),$("#searchbox").keypress(function(e){13==e.which&&e.preventDefault()}),$("#featureModal").on("hidden.bs.modal",function(e){$(document).on("mouseout",".feature-row",clearHighlight)}),$(document).one("ajaxStop",function(){$("#loading").hide(),sizeLayerControl(),map.fitBounds(bounds),featureList=new List("features",{valueNames:["feature-name"]}),featureList.sort("feature-name",{order:"asc"});var e=new Bloodhound({name:"Huntingareas",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:huntingareaSearch,limit:10}),t=new Bloodhound({name:"Maraes",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:maraeSearch,limit:10}),a=new Bloodhound({name:"Campsites",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:campsiteSearch,limit:10}),r=new Bloodhound({name:"Carparks",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:carparkSearch,limit:10}),i=new Bloodhound({name:"Huts",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,local:hutSearch,limit:10}),o=new Bloodhound({name:"GeoNames",datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.name)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:"http://api.geonames.org/searchJSON?username=bootleaf&featureClass=P&maxRows=5&countryCode=NZ&name_startsWith=%QUERY",filter:function(e){return $.map(e.geonames,function(e){return{name:e.name+", "+e.adminCode1,lat:e.lat,lng:e.lng,source:"GeoNames"}})},ajax:{beforeSend:function(e,t){t.url+="&east="+map.getBounds().getEast()+"&west="+map.getBounds().getWest()+"&north="+map.getBounds().getNorth()+"&south="+map.getBounds().getSouth(),$("#searchicon").removeClass("fa-search").addClass("fa-refresh fa-spin")},complete:function(e,t){$("#searchicon").removeClass("fa-refresh fa-spin").addClass("fa-search")}}},limit:10});e.initialize(),t.initialize(),a.initialize(),r.initialize(),i.initialize(),o.initialize(),$("#searchbox").typeahead({minLength:3,highlight:!0,hint:!1},{name:"Huntingareas",displayKey:"name",source:e.ttAdapter(),templates:{header:"<h4 class='typeahead-header'>Huntingareas</h4>"}},{name:"Maraes",displayKey:"name",source:t.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/marae.png' width='24' height='28'>&nbsp;Maraes</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"Campsites",displayKey:"name",source:a.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/camping.png' width='32' height='37'>&nbsp;Campsites</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"Carparks",displayKey:"name",source:r.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/carpark.png' width='32' height='37'>&nbsp;Carparks</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"Huts",displayKey:"name",source:i.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/hut.png' width='32' height='37'>&nbsp;Huts</h4>",suggestion:Handlebars.compile(["{{name}}<br>&nbsp;<small>{{address}}</small>"].join(""))}},{name:"GeoNames",displayKey:"name",source:o.ttAdapter(),templates:{header:"<h4 class='typeahead-header'><img src='assets/img/globe.png' width='25' height='25'>&nbsp;GeoNames</h4>"}}).on("typeahead:selected",function(e,t){"Huntingareas"===t.source&&map.fitBounds(t.bounds),"Maraes"===t.source&&(map.hasLayer(maraeLayer)||map.addLayer(maraeLayer),map.setView([t.lat,t.lng],17),map._layers[t.id]&&map._layers[t.id].fire("click")),"Campsites"===t.source&&(map.hasLayer(campsiteLayer)||map.addLayer(campsiteLayer),map.setView([t.lat,t.lng],17),map._layers[t.id]&&map._layers[t.id].fire("click")),"Carparks"===t.source&&(map.hasLayer(carparkLayer)||map.addLayer(carparkLayer),map.setView([t.lat,t.lng],17),map._layers[t.id]&&map._layers[t.id].fire("click")),"Huts"===t.source&&(map.hasLayer(hutLayer)||map.addLayer(hutLayer),map.setView([t.lat,t.lng],17),map._layers[t.id]&&map._layers[t.id].fire("click")),"GeoNames"===t.source&&map.setView([t.lat,t.lng],14),$(".navbar-collapse").height()>50&&$(".navbar-collapse").collapse("hide")}).on("typeahead:opened",function(){$(".navbar-collapse.in").css("max-height",$(document).height()-$(".navbar-header").height()),$(".navbar-collapse.in").css("height",$(document).height()-$(".navbar-header").height())}).on("typeahead:closed",function(){$(".navbar-collapse.in").css("max-height",""),$(".navbar-collapse.in").css("height","")}),$(".twitter-typeahead").css("position","static"),$(".twitter-typeahead").css("display","block")});var container=$(".leaflet-control-layers")[0];L.Browser.touch?L.DomEvent.disableClickPropagation(container):L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container);